{% extends "@EasyAdmin/page/content.html.twig" %}

{% block head_javascript %}
    {{ parent() }}
    {{ encore_entry_script_tags('admin/statistics/dashboard') }}
{% endblock head_javascript %}

{% block main %}
<main>
    <h1 class="title">Statistiques globales</h1>

    <div class="alert alert-success mt-5 mb-5">
        <p class="fs-5"><strong>
            <a href="">{{ nbUsers|number_format(0, ',', ' ') }} comptes utilisateurs</a></strong>,
            répartis en <strong><a href="">{{ nbOrganizations|number_format(0, ',', ' ') }} structures</a></strong>
            (<a href="">carte</a>),
            dont <strong><a href="">{{ nbInterco|number_format(0, ',', ' ') }} intercommunalités</a></strong>,
            ont créé <strong><a href="">{{ nbProjects|number_format(0, ',', ' ') }} projets</a></strong>
            avec en tout <strong>{{ nbAidProjects|number_format(0, ',', ' ') }} aides sélectionnées</strong> sur un total de
            <strong>{{ nbAidsLive|number_format(0, ',', ' ') }} aides disponibles</strong> publiées par
            <strong>{{ nbBackers|number_format(0, ',', ' ') }} porteurs</strong>.
            Sont également disponibles <strong>{{ nbSearchPages|number_format(0, ',', ' ') }} portails</strong>.
            <span class="fr-hint-text">Pour rappel, le compte utilisateur a été lancé le 4 novembre 2021.</span>
        </p>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div>{{ render_chart(chartCommune) }}</div>
            <h4 class="text-center"><a href="">{{ nbCommune }} communes / {{ nbCommuneTotal }}</a></h4>
        </div>
        <div class="col-md-6">
            <div>{{ render_chart(chartEcpi) }}</div>
            <h4 class="text-center"><a href="">{{ nbEcpi }} ({{ nbEcpiPercentage }} %). Objectif : {{ nbEcpiObjectifPercentage }}%</a></h4>
        </div>
    </div>

    <div id="statistiques" class="mt-5 mb-5 d-flex flex-row justify-content-center align-items-center">
        <h2 class="me-3">Statistiques sur une période :</h2>
        <div class="d-flex me-3">
        {{ form_start(formDateRange) }}
        </div>
        <div class="d-flex me-3">
        {{ form_row(formDateRange.dateMin) }}
        </div>
        <div class="d-flex me-3">
        {{ form_row(formDateRange.dateMax) }}
        </div>
        <div class="d-flex me-3">
        <button type="submit" class="btn btn-primary">Valider</button>
        </div>
        {{ form_end(formDateRange) }}
    </div>

    <div class="container mb-5">
        <ul class="nav nav-tabs" role="tablist" aria-label="Différentes statistiques">
            <li class="nav-item" role="presentation">
                <a
                    id="consultation"
                    href="#statistiques"
                    class="nav-link {% if consultationSelected %}active{% endif %}"
                    tabindex="{% if consultationSelected %}0{% else %}-1{% endif %}"
                    role="tab"
                    aria-selected="{% if consultationSelected %}true{% else %}false{% endif %}"
                    aria-controls="consultation-panel"
                    ><span aria-hidden="true">👥 </span>Consultation</a>
            </li>
            <li class="nav-item" role="presentation">
                <a
                    id="acquisition"
                    href="#statistiques"
                    class="nav-link {% if acquisitionSelected %}active{% endif %}"
                    tabindex="{% if acquisitionSelected %}0{% else %}-1{% endif %}"
                    role="tab"
                    aria-selected="{% if acquisitionSelected %}true{% else %}false{% endif %}"
                    aria-controls="acquisition-panel"
                    ><span aria-hidden="true">🎣 </span>Acquisition</a>
            </li>
            <li class="nav-item" role="presentation">
                <a
                    id="engagement"
                    href="#statistiques"
                    class="nav-link {% if engagementSelected %}active{% endif %}"
                    tabindex="{% if engagementSelected %}0{% else %}-1{% endif %}"
                    role="tab"
                    aria-selected="{% if engagementSelected %}true{% else %}false{% endif %}"
                    aria-controls="engagement-panel"
                    ><span aria-hidden="true">🏅 </span>Engagement</a>
            </li>
            <li class="nav-item" role="presentation">
                <a
                    id="cote-porteurs"
                    href="#statistiques"
                    class="nav-link {% if porteursSelected %}active{% endif %}"
                    tabindex="{% if porteursSelected %}0{% else %}-1{% endif %}"
                    role="tab"
                    aria-selected="{% if porteursSelected %}true{% else %}false{% endif %}"
                    aria-controls="cote-porteurs-panel"
                    ><span aria-hidden="true">💪 </span>Côté porteurs</a>
            </li>
        </ul>
        
        <div id="consultation-panel" class="fr-tabs__panel fr-tabs__panel--selected" role="tabpanel" aria-labelledby="consultation" tabindex="0">
            <div class="d-flex">

                    <div class="card col">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <h5 class="card-title">
                                <a class="card-link" href="#">
                                    Nombre de visiteurs
                                </a>
                            </h5>
                            <p class="card-text fs-2"><strong>{% if statsMatomo.nb_visits is defined %}{{ statsMatomo.nb_visits }}{% endif %}</strong></p>
                        </div>
                    </div>

                    <div class="card col">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <h5 class="card-title">
                                <a class="card-link" href="#">Taux de rebond</a>
                            </h5>
                            <p class="card-text fs-2"><strong>{% if statsMatomo.bounce_rate is defined %}{{ statsMatomo.bounce_rate }}{% endif %}</strong></p>
                        </div>
                    </div>

                    <div class="card col">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <h5 class="card-title">
                                <a class="card-link" href="#">
                                    Durée moyenne d’une visite
                                </a>
                            </h5>
                            <p class="card-text fs-2"><strong>{% if statsMatomo.avg_time_on_site is defined %}{{ statsMatomo.avg_time_on_site }}{% endif %}</strong></p>
                        </div>
                    </div>

                    <div class="card col">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <h5 class="card-title">
                                <a class="card-link" href="#">
                                    Nombre de pages vues
                                </a>
                            </h5>
                            <p class="card-text fs-2"><strong>{% if statsMatomoActions.nb_pageviews is defined %}{{ statsMatomoActions.nb_pageviews }}{% endif %}</strong></p>
                        </div>
                    </div>

                    <div class="card col">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <h5 class="card-title">
                                <a class="card-link" href="">
                                    Nombre d’aides vues (sans l’API)
                                </a>
                            </h5>
                            <p class="card-text fs-2"><strong>{% if nbAidViews is defined %}{{ nbAidViews }}{% endif %}</strong></p>
                        </div>
                    </div>

                    <div class="card col">
                        <div class="card-body d-flex flex-column justify-content-between">
                            <h5 class="card-title">
                                <a class="card-link" href="">
                                    Nombre d’aides vues différentes (sans l’API)
                                </a>
                            </h5>
                            <p class="card-text fs-2"><strong>{% if nbAidViewsDistinct is defined %}{{ nbAidViewsDistinct }}{% endif %}</strong></p>
                        </div>
                    </div>

            </div>

            <h3 class="mt-5"><span aria-hidden="true">🚀 </span>Visites uniques ces 10 dernières semaines :</h3>
            <div class="alert alert-info">
                <p>Les inscriptions et alertes créées sont multipliées par 20 afin qu’elles soient visibles et comparables avec les visites uniques.</p>
                <p>Cela permet de visualiser une conversion hebdomadaire en fonction des actions engagées par l’équipe.</p>
            </div>
            <div class="mt-5">
                <div>{{ render_chart(chartLast10Weeks) }}</div>
            </div>
        </div>
    </div>
</main>
{% endblock %}